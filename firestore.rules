rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Helper: Verify data structure
    function isValidBooking() {
      let data = request.resource.data;
      return 
        // Must have a shareholder Name
        data.shareholderName is string && data.shareholderName.size() > 0 &&
        
        // Must have Dates
        data.from is timestamp &&
        data.to is timestamp &&
        data.createdAt is timestamp &&
        
        // Type must be booking or pass
        (data.type == 'booking' || data.type == 'pass') &&
        
        // Basic Logic
        data.to > data.from;
    }

    match /bookings/{bookingId} {
      // READ: Publicly readable (required for Dashboard)
      allow read: if true;

      // WRITE: Allow if authenticated AND validates schema
      allow create: if request.auth != null && isValidBooking();
      allow update: if request.auth != null && isValidBooking();
      
      // DELETE: Authenticated users only (e.g. Admins or Owner)
      allow delete: if request.auth != null;
    }
  }
}
